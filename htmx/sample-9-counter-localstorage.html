<!doctype html><html lang="ja"><head>
<meta charset="UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'; style-src 'self'; img-src 'self' data:; connect-src 'self'; object-src 'none'; base-uri 'self'; frame-ancestors 'none'; form-action 'self'; upgrade-insecure-requests" />
<title>HTMX 9: LocalStorageカウンター（DOM/BOM）</title><link rel="stylesheet" href="../style.css" /><script src="sample-9-counter-localstorage.js" defer></script>
</head><body><main class="container"><h1>9) LocalStorageカウンター（DOM/BOM）</h1>
<p>静的サイトで「本当に増減」し、再読み込み後も値を保持するカウンター。</p>

<section class="card">
  <h2>デモ（実動）</h2>
  <p>現在値: <strong id="ls-count">0</strong></p>
  <div class="row">
    <button id="btn-plus" class="link-btn" type="button">+1</button>
    <button id="btn-minus" class="link-btn" type="button">-1</button>
    <button id="btn-reset" class="link-btn" type="button">Reset</button>
  </div>
  <p class="sim-note-small">保存先キー: <code>demo.counter.value</code></p>
</section>

<section class="card">
  <h2>解説（LocalStorage版）</h2>
  <ul>
    <li><code>localStorage</code> から初期値を読み出して表示。</li>
    <li>クリックで数値を更新し、DOMの <code>textContent</code> を再描画。</li>
    <li>更新後の値を <code>localStorage.setItem()</code> で保存。</li>
  </ul>
</section>

<section class="card">
  <h2>このサンプルのコード（LocalStorage）</h2>
  <pre style="white-space:pre-wrap;overflow:auto;"><code>const KEY = 'demo.counter.value';
let count = Number(localStorage.getItem(KEY) ?? '0');
countEl.textContent = String(count);

plusBtn.addEventListener('click', () =&gt; {
  count += 1;
  countEl.textContent = String(count);
  localStorage.setItem(KEY, String(count));
});</code></pre>
</section>

<section class="card">
  <h2>HTMX（サーバーPOST）で同じことをする場合</h2>
  <p>動的値をサーバーで持つなら、<code>hx-post</code> で更新要求を送り、<strong>更新後のHTML断片を返して埋め込む</strong>のが基本。</p>
  <pre style="white-space:pre-wrap;overflow:auto;"><code>&lt;div id="counter-panel"&gt;
  &lt;p&gt;現在値: &lt;strong&gt;12&lt;/strong&gt;&lt;/p&gt;
  &lt;button hx-post="/counter/plus"
    hx-target="#counter-panel"
    hx-swap="innerHTML"&gt;+1&lt;/button&gt;
&lt;/div&gt;

# サーバー側の /counter/plus は count を +1 して
# その最新値を含む HTML断片（counter-panelの中身）を返す</code></pre>
  <p class="sim-note-small">つまり「HTMXは差し替え係」、計算・状態保持はサーバー側が担当。</p>
</section>

<section class="card">
  <h2>比較まとめ（どっちを使う？）</h2>
  <ul>
    <li><strong>LocalStorage版</strong>: 静的サイトだけで完結。実装が最小。単一ブラウザ内の保持に強い。</li>
    <li><strong>HTMX + POST版</strong>: 複数端末で状態共有したい時に有利（サーバー状態）。</li>
    <li><strong>判断基準</strong>: 「個人ブラウザ内だけで十分」ならLocalStorage、「共有・一貫性」ならサーバーPOST。</li>
  </ul>
</section>

<p><a href="index.html">← 一覧へ</a></p></main></body></html>
